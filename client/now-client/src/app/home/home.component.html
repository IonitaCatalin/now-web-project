<mat-sidenav-container>
  <mat-sidenav
    #sidenav
    mode="side"
    [opened]="sidenavIsOpen"
    (openedChange)="onSidenavChange()"
  >
    <div class="toggle-button">
      <button style="text-align: end" *ngIf="sidenavIsOpen" mat-icon-button (click)="toggleSidenav()">
        <mat-icon>menu</mat-icon>
      </button>
    </div>
    <div class="d-flex justify-content-center align-items-center flex-column">
      <div>
        <fa-icon style="font-size: 8rem;" [icon]="faUserTie"></fa-icon>
      </div>
      <ng-container *ngIf="currentUser$ | async as currentUser">
        <div style="padding-top: 1rem;">
          <span *ngIf="currentUser.isAuth">Hello, {{currentUser.email}}</span>
          <span *ngIf="!currentUser.isAuth">You are not logged in!</span>
        </div>
        <div style="margin-top: 1rem;">
          <button *ngIf="currentUser.isAuth" mat-raised-button (click)="logout()">Logout</button>
          <button *ngIf="!currentUser.isAuth" mat-raised-button (click)="login()">Login</button>
        </div>
      </ng-container>
    </div>
    <div class="p-2">
      <mat-form-field class="search">
        <input
          matInput
          matTooltip="Search by name, type or service"
          type="text"
          placeholder="Smart Search"
          [(ngModel)]="searchTerm"
          (ngModelChange)="search()"
        />
        <button
          mat-button
          *ngIf="searchTerm"
          matSuffix
          mat-icon-button
          aria-label="Clear"
          (click)="clearSearch()"
        >
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>
    </div>
    <div class="list-closest">
      <mat-list>
        <ng-container *ngFor="let closestEntity of filteredClosestEntities$ | async">
          <mat-list-item matRipple style="cursor: pointer" class="list-closest-item"
                         (click)="focusOn(closestEntity.coordinates, closestEntity.type)">
            <div class="d-flex justify-content-between" style="width: 100%;">
              <div class="d-flex flex-column">
                <span>{{closestEntity.name}}</span>
                <h5 style="margin-bottom: 0">{{closestEntity.type}}</h5>
              </div>
              <h4 style="margin-bottom: 0">{{closestEntity.distance | number : '1.0-2'}}km</h4>
            </div>
          </mat-list-item>
          <mat-divider></mat-divider>
        </ng-container>
      </mat-list>
    </div>
  </mat-sidenav>
  <mat-sidenav-content>
    <section class="content">
      <button *ngIf="!sidenavIsOpen" mat-icon-button (click)="toggleSidenav()">
        <mat-icon>menu</mat-icon>
      </button>
      <app-map #mapComponent></app-map>
    </section>
  </mat-sidenav-content>
</mat-sidenav-container>
